angular.module("PlantsApp",["ionic","ui.router","pouchdb"]).directive("plantMainMenu",function(){return{restrict:"E",templateUrl:"app/menus/main.html"}}),function(){angular.module("PlantsApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("","/list"),b.when("/","/list"),b.when("/list","/list/"),a.state("list",{url:"/list/{id}",controller:"PlantListCtrl",templateUrl:"app/components/plant/list.html"}),a.state("detail",{url:"/detail/{code}",controller:"PlantDetailCtrl",templateUrl:"app/components/plant/detail.html"})}])}(),function(){function a(a,b,c,d){var e=b.code;a.getPhotoUrl=d.getPhotoUrl,c.getPlant(e).then(function(b){a.plant=b,d.query(b.scientific,function(b){console.log("photo queried",b);var c=d.getPhotos(b);a.photos=c,c.length>0&&(a.thumbnail=d.getPhotoUrl(c[0],d.SMALL),a.caption=c[0].title)})})}angular.module("PlantsApp").controller("PlantDetailCtrl",["$scope","$stateParams","plantList","flickr",a])}(),function(){function a(a,b,c,d){d.isLoading()&&c.show({template:"Initializing Plant List..."}),a.genusSuffix=function(a){return a.code.lastIndexOf("SPP")==a.code.length-3?" spp. (lump)":a.scientific==a.genus?" sp.":""};var e=b.id||d.ALL_PLANTS;a.listName=d.getListName(e),d.getPlants(e).then(function(b){console.log(b),a.plants=b,c.hide()})}angular.module("PlantsApp").controller("PlantListCtrl",["$scope","$stateParams","$ionicLoading","plantList",a])}(),function(){function a(a,b){var c={THUMB:"t",SMALL:"m",MEDIUM:"z",LARGE:"b",getServiceUrl:function(a){return"https://www.flickr.com/services/rest/?method="+a},query:function(d,e){b.load(function(){var f=c.getServiceUrl("flickr.photos.search")+"&sort=relevance&per_page=10&format=json&text="+d+"&api_key="+b.get("flickr_api_key");return a.jsonp(f+"&jsoncallback=JSON_CALLBACK").success(e)})},getPhotos:function(a){return"ok"!=a.stat?[]:a.photos.photo},getPhotoUrl:function(a,b){return"https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+(b||c.THUMB)+".jpg"}};return c}angular.module("PlantsApp").factory("flickr",["$http","config",a])}(),function(){function a(a,b,c){function d(){var d=c("plants");return b.all([d.get("VIRO3")["catch"](function(b){if(404!==b.status)throw b;return a.get("assets/json/all_plants.json").then(function(a){return a.data.map(function(a){return a._id=a.code,a})})["catch"](function(a){console.log("Error fetching all_plants.json",a)}).then(function(a){return console.log("plants",a),d.bulkDocs(a)})}),d.get("list-plant:2014 TALL Diversity/TALL_001/Subplot 31/TALL_001 31.1.10:VIRO3")["catch"](function(b){if(404!==b.status)throw b;return a.get("assets/json/div_lists.json").then(function(a){return console.log("list-plants",a),d.bulkDocs(a.data)})["catch"](function(a){console.log("Error fetching div_lists.json",a)})})]).then(function(){return g=!1,d})}function e(a){return function(){var b=Array.prototype.slice.call(arguments);return f.then(function(c){return a.apply(a,[c].concat(b))})}}var f=d(),g=!0,h={ALL_PLANTS:"All Plants",isLoading:function(){return g},getPlant:e(function(a,b){return a.get(b).then(function(a){return a.code=a._id,a})}),getListName:function(a){return a==h.ALL_PLANTS?a:a.substr(a.lastIndexOf("/")+1)},getLists:e(function(a){return console.log("getLists start",new Date),a.allDocs({startkey:"A",endkey:"ZZZZ"}).then(function(b){var c=[{id:h.ALL_PLANTS,name:h.ALL_PLANTS,parent:null,children:[],count:b.rows.length}];return console.log("getLists got ALL_PLANTS",new Date),a.allDocs({startkey:"list-plant:",endkey:"list-plant:￿"}).then(function(a){function b(a){for(var b=a.split(":"),c=b[1],f=b[2],g=e[c]||d(c);g;)g.plantsMap[f]||(g.plantsMap[f]=!0,g.plants.push(f),++g.count),g=g.parent}function d(a){var b=a.match(/(.*)\/([^\/]*)$/),f={id:a,name:b?b[2]:a,parent:b?b[1]:null,children:[],plants:[],plantsMap:{},count:0};if(e[f.id]=f,f.parent){var g=e[f.parent]||d(f.parent);f.parent=g,g.children.push(f)}return f.parent||c.push(f),f}console.log("getLists got list-plants",new Date);var e={};return angular.forEach(a.rows,function(a){b(a.key)}),console.log("getLists done",new Date),c})})}),getPlants:e(function(a,b){var c;return b==h.ALL_PLANTS||void 0===b?(c={startkey:"A",endkey:"Z￿",include_docs:!0},console.log("getPlants: allDocs",c),a.allDocs(c).then(function(a){return console.log("getPlants: result",a),a.rows.map(function(a){return a.doc})})):(c={startkey:"list-plant:"+b+"/",endkey:"list-plant:"+b+"/￿"},console.log("getPlants: allDocs",c),a.allDocs(c).then(function(d){return c={startkey:"list-plant:"+b+":",endkey:"list-plant:"+b+":￿"},console.log("getPlants: allDocs",c),a.allDocs(c).then(function(a){return d.rows.concat(a.rows)})}).then(function(b){var c=[],d={};return angular.forEach(b,function(a){var b=a.key.split(":"),e=b[2];d[e]||(d[e]=!0,c.push(e))}),a.allDocs({keys:c,include_docs:!0}).then(function(a){return console.log("getPlants: result",a),a.rows.map(function(a){return a.doc||{code:a.key,scientific:a.key,common:"unknown"}})})}))})};return h}angular.module("PlantsApp").factory("plantList",["$http","$q","pouchDB",a])}(),function(){function a(a,b){var c={};a.toggleChildren=function(a){c[a.id]=!c[a.id]},a.areChildrenShown=function(a){return c[a.id]},b.getLists().then(function(b){console.log("Lists",b),a.plantLists=b})}angular.module("PlantsApp").controller("MainMenuCtrl",["$scope","plantList",a])}(),function(){function a(a){var b={get:function(b){return a.get("config-"+b)},set:function(b,c){a.set("config-"+b,c)},hasConfig:function(){return null!=b.get("version")},load:function(a){b.hasConfig()?a(b):b.update(a)},update:function(a){a(b)}};return b}angular.module("PlantsApp").factory("config",["storage",a])}(),function(){PouchDB.plugin({putIfNotExists:function(a,b){return this.put(a,b)["catch"](function(b){if(409!=b.status)throw b;return a})},createViewDoc:function(a,b,c){var d={_id:"_design/"+a,views:{}};return d.views[a]={map:b.toString()},c&&(d.views[a].reduce=c.toString()),d},upsertView:function(a,b,c){var d=this,e=d.createViewDoc(a,b,c);return d.get(e._id).then(function(b){return b.views[a].map!=e.views[a].map||b.views[a].reduce!=e.views[a].reduce?(e._rev=b._rev,d.put(e)):b})["catch"](function(a){if(404===a.status)return d.put(e);throw a})}})}(),function(){function a(a){var b={_data:{},get:function(a,c){return b._data[a]||(b._data[a]=JSON.parse(localStorage.getItem(a))||c)},set:function(a,c){b._data[a]=c,localStorage.setItem(a,JSON.stringify(c))},getPromise:function(c,d){return a(function(a){a(b.get(c,d))})}};return b}angular.module("PlantsApp").factory("storage",["$q",a])}(),angular.module("PlantsApp").run(["$templateCache",function(a){"use strict";a.put("app/components/plant/detail.html",'<ion-view><ion-nav-title>{{ plant.scientific }}</ion-nav-title><ion-content><h2>{{ plant.scientific }}</h2><h3>{{ plant.common }}</h3><a href="http://plants.usda.gov/core/profile?symbol={{plant.code}}">USDA</a><div class=plant-detail><div class=row><div class=col>Code</div><div class=col>{{ plant.code }}</div></div><div class=row><div class=col>Family</div><div class=col>{{ plant.family }} ({{ plant.familyCommon }})</div></div><div class=row><div class=col>Growth Form</div><div class=col>{{ plant.growth.join(\', \') }}</div></div></div><h3 ng-show="plant.synonyms.length > 0">Synonyms</h3><div class=row ng-repeat="synonym in plant.synonyms"><div class=col-25>{{ synonym.code }}</div><div class="col scientific">{{ synonym.scientific }}</div></div><div class=plant-thumb><img src="{{ thumbnail }}"><div class=thumb-caption>{{ caption }}</div></div></ion-content></ion-view>'),a.put("app/components/plant/list.html",'<ion-view><ion-nav-title>{{ listName }}</ion-nav-title><ion-header-bar align-title=left class="bar-subheader bar-clear item-input-inset"><label class=item-input-wrapper><i class="icon ion-ios-search placeholder-icon"></i> <input type=search placeholder=Search ng-model=searchText> <button class="button ion-android-close button-dark button-clear" ng-show=searchText on-tap="searchText=\'\'"></button></label></ion-header-bar><ion-content><ion-list class=plant-list><ion-item collection-repeat="plant in plants | filter:searchText | orderBy:\'scientific\'" ui-sref=detail({code:plant.code}) ng-class="plant.idYear ? \'id-\' + plant.idYear : \'\'"><div class=col-code>{{ plant.code }}</div><div class=col-name><div class=scientific>{{ plant.scientific }}{{ genusSuffix(plant) }}</div><div class=common>{{ plant.common }}</div></div><div class=col-growth><div ng-repeat="form in plant.growth" ng-class="\'growth-\' + form.toLowerCase().split(\'/\')[0]">{{ form == "Fern" ? "Fn" : form[0] }}</div></div></ion-item></ion-list></ion-content></ion-view>'),a.put("app/menus/list_item.html","<ion-item ng-style=\"{'padding-left':(16 * (list.depth = 1 + (list.parent.depth || 0))) +  'px'}\"><a class=expand-collapse ng-class=\"areChildrenShown(list) ? 'ion-arrow-down-b' : 'ion-arrow-right-b'\" ng-show=\"list.children.length > 0\" ng-click=toggleChildren(list)></a> <span ui-sref=list({id:list.id}) menu-close>{{ list.name }} ({{ list.count }})</span></ion-item><div ng-show=areChildrenShown(list)><div ng-repeat=\"list in list.children\" ng-include=\"'app/menus/list_item.html'\"></div></div>"),a.put("app/menus/main.html",'<ion-header-bar class="bar bar-header bar-balanced"><h1 class=title>Plant Lists</h1></ion-header-bar><ion-content has-header=true ng-controller=MainMenuCtrl><ion-list><div ng-repeat="list in plantLists" ng-include="\'app/menus/list_item.html\'"></div></ion-list></ion-content>')}]);
//# sourceMappingURL=app.min.js.map