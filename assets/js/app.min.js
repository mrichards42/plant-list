angular.module("PlantsApp",["ionic","ui.router"]),function(){function a(a,b,c){b.nextViewOptions({disableAnimate:!0,disableBack:!0}),c.authenticate({interactive:!1},function(b,c){b?(c.reset(),a.go("login")):a.go("list")})}angular.module("PlantsApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/access_token=:accessToken",["$location",function(a){var b=a.path().substr(1);return console.log("when",a.path()),"/login/"+b}]),a.state("index",{url:"/",controller:"IndexCtrl",templateUrl:""}),b.when("","/"),a.state("login",{url:"/login",controller:"LoginCtrl",templateUrl:"app/components/login/login.html"}),a.state("auth",{url:"/login/access_token={access_token}&token_type={token_type}&state={state}&uid={uid}",controller:"LoginCtrl",templateUrl:"app/components/login/login.html"}),a.state("list",{url:"/list",controller:"PlantListCtrl",templateUrl:"app/components/plant/list.html"}),a.state("detail",{url:"/detail/{code}",controller:"PlantDetailCtrl",templateUrl:"app/components/plant/detail.html"})}]).controller("IndexCtrl",["$state","$ionicHistory","dropbox",a])}(),function(){function a(a,b,c,d){if(a.authenticate=function(){d.authenticate(function(a,b){return a?(b.reset(),alert("Error logging in to Dropbox: "+a)):void 0})},!d.isAuthenticated()&&b.access_token){var e=d.credentials();e.token=b.access_token,d.setCredentials(e),console.log("params:",b),console.log("credentials:",e),console.log("dropbox",d),d.authenticate({interactive:!1}),console.log("authenticated:",d.isAuthenticated()),localStorage.setItem("dropbox-token",e.token)}a.isAuthenticated=d.isAuthenticated(),d.isAuthenticated()&&(listDir("/"),c.loadFromDropbox(function(a){console.log(a)}))}angular.module("PlantsApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/access_token=:accessToken",function(a){var b=a.path().substr(1);return console.log("when",a.path()),"/login/"+b})}]).controller("LoginCtrl",["$scope","$stateParams","config","dropbox",a])}(),function(){function a(a,b,c,d){var e=b.code;a.flickr=d,a.getPhotoUrl=d.getPhotoUrl,c().success(function(b){for(var c=0;c<b.length;++c){var f=b[c];if(f.code==e){a.plant=f,console.log("DetailCtrl done",f),d.query(f.scientific,function(b){console.log("Flickr done",b);var c=d.getPhotos(b);a.photos=c,c.length>0&&(a.thumbnail=d.getPhotoUrl(c[0],d.SMALL),a.caption=c[0].title)});break}}})}angular.module("PlantsApp").controller("PlantDetailCtrl",["$scope","$stateParams","plantList","flickr",a])}(),function(){function a(a,b){b().success(function(b){a.plants=b,console.log("PlantListCtrl done",b)})}angular.module("PlantsApp").controller("PlantListCtrl",["$scope","plantList",a])}(),function(){function a(a,b){var c={THUMB:"t",SMALL:"m",MEDIUM:"z",LARGE:"b",getServiceUrl:function(a){return"https://www.flickr.com/services/rest/?method="+a},query:function(d,e){b.load(function(){var f=c.getServiceUrl("flickr.photos.search")+"&sort=relevance&per_page=10&format=json&text="+d+"&api_key="+b.get("flickr_api_key");return a.jsonp(f+"&jsoncallback=JSON_CALLBACK").success(e)})},getPhotos:function(a){return"ok"!=a.stat?[]:a.photos.photo},getPhotoUrl:function(a,b){return"https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+(b||c.THUMB)+".jpg"}};return c}angular.module("PlantsApp").factory("flickr",["$http","config",a])}(),function(){function a(a){var b=null;return function(){return b||(b=a.get("assets/json/plants.json"),console.log("Getting plants list")),b}}angular.module("PlantsApp").factory("plantList",["$http",a])}(),function(){function a(a){var b={_config:{},get:function(a){return b._config[a]||JSON.parse(localStorage.getItem("config-"+a))},set:function(a,c){b._config[a]=c,localStorage.setItem("config-"+a,JSON.stringify(c))},hasConfig:function(){return null!=b.get("version")},load:function(a){b.hasConfig()?a(b):b.update(a)},update:function(c){a.readFile("/plants_data/config.json",function(a,d){if(console.log(a,d),a)console.log("error fetching config.json",a);else if(d){var e=JSON.parse(d),f=b.get("version");if(!f||e.version>version)for(var g in e)b.set(g,e[g]);c&&c(b)}})}};return b}angular.module("PlantsApp").factory("config",["dropbox",a])}(),function(){function a(){var a={key:"72z2t0scx09nr87"};return a.token=localStorage.getItem("dropbox-token"),new Dropbox.Client(a)}angular.module("PlantsApp").factory("dropbox",a)}(),angular.module("PlantsApp").run(["$templateCache",function(a){"use strict";a.put("app/components/login/login.html",'<ion-view><ion-nav-title>Login</ion-nav-title><ion-content><div ng-hide=isAuthenticated><button ng-click=authenticate()>Login</button></div><ion-list><ion-item ng-repeat="entry in entries">{{entry}}</ion-item></ion-list></ion-content></ion-view>'),a.put("app/components/plant/detail.html","<ion-view><ion-nav-title>{{ plant.scientific }}</ion-nav-title><ion-content><h2>{{ plant.scientific }}</h2><h3>{{ plant.common }}</h3><div class=plant-detail><div class=row><div class=col>Code</div><div class=col>{{ plant.code }}</div></div><div class=row><div class=col>Family</div><div class=col>{{ plant.family }} ({{ plant.familyCommon }})</div></div><div class=row><div class=col>Growth Form</div><div class=col>{{ plant.growth.join(', ') }}</div></div></div><div class=plant-thumb><img src=\"{{ thumbnail }}\"><div class=thumb-caption>{{ caption }}</div></div></ion-content></ion-view>"),a.put("app/components/plant/list.html",'<ion-view><ion-nav-title>TALL Plant List</ion-nav-title><ion-header-bar align-title=left class="bar-subheader bar-clear item-input-inset"><label class=item-input-wrapper><i class="icon ion-ios-search placeholder-icon"></i> <input type=search placeholder=Search ng-model=searchText> <button class="button ion-android-close button-dark button-clear" ng-show=searchText on-tap="searchText=\'\'"></button></label></ion-header-bar><ion-content><ion-list><ion-item collection-repeat="plant in plants | filter:searchText | orderBy:\'scientific\'" ui-sref=detail({code:plant.code}) ng-class="plant.idYear ? \'id-\' + plant.idYear : \'\'"><span class=col-code>{{ plant.code }}</span> <span class=col-scientific>{{ plant.scientific }}</span> <span class=col-growth><span ng-repeat="form in plant.growth" ng-class="\'growth-\' + form.toLowerCase().split(\'/\')[0]">{{ form == "Fern" ? "Fn" : form[0] }}</span></span></ion-item></ion-list></ion-content></ion-view>')}]);
//# sourceMappingURL=app.min.js.map